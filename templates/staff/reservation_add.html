{% extends 'base.html' %}
{% load static %}

{% block title %}QuickOil - 예약 추가{% endblock %}

{% block content %}
<div class="bg-gray-100 min-h-screen py-6">
    <div class="mx-auto max-w-6xl px-6">
        <!-- 헤더 -->
        <div class="flex items-center gap-4 mb-6">
            <a href="{% url 'reservation_list' %}" class="p-2 bg-white rounded-lg hover:bg-gray-50">
                <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
            </a>
            <h1 class="text-2xl font-bold text-gray-900">예약 추가</h1>
        </div>

        <form method="post">
            {% csrf_token %}

            <div class="grid grid-cols-3 gap-6">
                <!-- 좌측: 고객 정보 -->
                <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
                    <div class="px-5 py-3 border-b border-gray-200 bg-gray-50">
                        <h3 class="font-semibold text-gray-900">고객 정보</h3>
                    </div>
                    <div class="p-5 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">전화번호 *</label>
                            <input type="tel" name="customer_phone" placeholder="010-1234-5678" required
                                class="w-full px-4 py-3 text-lg border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">고객명</label>
                            <input type="text" name="customer_name" placeholder="홍길동"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">차량번호</label>
                            <input type="text" name="car_number" placeholder="12가 3456"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                    </div>
                </div>

                <!-- 중간: 예약 일시 + 차량 -->
                <div class="space-y-6">
                    <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
                        <div class="px-5 py-3 border-b border-gray-200 bg-gray-50">
                            <h3 class="font-semibold text-gray-900">예약 일시</h3>
                        </div>
                        <div class="p-5 grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">날짜</label>
                                <input type="date" name="date" value="{{ today }}" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">시간</label>
                                <input type="time" name="time" value="10:00" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
                        <div class="px-5 py-3 border-b border-gray-200 bg-gray-50">
                            <h3 class="font-semibold text-gray-900">차량 정보</h3>
                        </div>
                        <div class="p-5 space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">브랜드</label>
                                <select name="brand" id="brand-select"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                    <option value="">선택 안함</option>
                                    {% for brand in brands %}
                                    <option value="{{ brand.id }}">{{ brand.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">차종</label>
                                <select name="model" id="model-select"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                    <option value="">브랜드 먼저 선택</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 우측: 예약 정보 + 버튼 -->
                <div class="space-y-6">
                    <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
                        <div class="px-5 py-3 border-b border-gray-200 bg-gray-50">
                            <h3 class="font-semibold text-gray-900">예약 정보</h3>
                        </div>
                        <div class="p-5 space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">예상 오일</label>
                                <select name="expected_oil"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                    <option value="">미정</option>
                                    {% for oil in oil_choices %}
                                    <option value="{{ oil }}">{{ oil }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">예약 경로</label>
                                <select name="source"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                    {% for value, label in source_choices %}
                                    <option value="{{ value }}">{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">메모</label>
                                <textarea name="memo" rows="2" placeholder="특이사항"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- 버튼 -->
                    <div class="flex gap-3">
                        <a href="{% url 'reservation_list' %}" class="flex-1 px-6 py-4 bg-gray-200 text-gray-700 font-semibold rounded-xl text-center hover:bg-gray-300">
                            취소
                        </a>
                        <button type="submit" class="flex-1 px-6 py-4 bg-orange-500 text-white font-semibold rounded-xl hover:bg-orange-600">
                            예약 추가
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
const brandsData = {{ brands_json|safe }};

document.getElementById('brand-select').addEventListener('change', function() {
    const brandId = this.value;
    const modelSelect = document.getElementById('model-select');

    modelSelect.innerHTML = '<option value="">선택 안함</option>';

    if (brandId) {
        const brand = brandsData.find(b => b.id == brandId);
        if (brand) {
            brand.models.forEach(model => {
                const option = document.createElement('option');
                option.value = model.id;
                option.textContent = model.name;
                modelSelect.appendChild(option);
            });
        }
    }
});
</script>
{% endblock %}
